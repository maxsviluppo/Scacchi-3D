import{Bd as N,Hf as P,If as _,dd as z,md as I,qd as D,zd as H}from"./chunk-6YFVS5NN.js";import"./chunk-2NFLSA4Y.js";var k=class extends P{constructor(h){super(h)}load(h,L,V,y){let S=this,x=new _(this.manager);x.setPath(this.path),x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setWithCredentials(this.withCredentials),x.load(h,function(E){try{L(S.parse(E))}catch(A){y?y(A):console.error(A),S.manager.itemError(h)}},V,y)}parse(h){function L(e){let t=new DataView(e),o=32/8*3+32/8*3*3+16/8,a=t.getUint32(80,!0);if(80+32/8+a*o===t.byteLength)return!0;let i=[115,111,108,105,100];for(let s=0;s<5;s++)if(V(i,t,s))return!1;return!0}function V(e,t,o){for(let a=0,f=e.length;a<f;a++)if(e[a]!==t.getUint8(o+a))return!1;return!0}function y(e){let t=new DataView(e),o=t.getUint32(80,!0),a,f,i,s=!1,m,B,C,U,b;for(let n=0;n<70;n++)t.getUint32(n,!1)==1129270351&&t.getUint8(n+4)==82&&t.getUint8(n+5)==61&&(s=!0,m=new Float32Array(o*3*3),B=t.getUint8(n+6)/255,C=t.getUint8(n+7)/255,U=t.getUint8(n+8)/255,b=t.getUint8(n+9)/255);let g=84,r=50,c=new N,p=new Float32Array(o*3*3),d=new Float32Array(o*3*3),w=new I;for(let n=0;n<o;n++){let F=g+n*r,T=t.getFloat32(F,!0),R=t.getFloat32(F+4,!0),v=t.getFloat32(F+8,!0);if(s){let l=t.getUint16(F+48,!0);(l&32768)===0?(a=(l&31)/31,f=(l>>5&31)/31,i=(l>>10&31)/31):(a=B,f=C,i=U)}for(let l=1;l<=3;l++){let G=F+l*12,u=n*3*3+(l-1)*3;p[u]=t.getFloat32(G,!0),p[u+1]=t.getFloat32(G+4,!0),p[u+2]=t.getFloat32(G+8,!0),d[u]=T,d[u+1]=R,d[u+2]=v,s&&(w.set(a,f,i).convertSRGBToLinear(),m[u]=w.r,m[u+1]=w.g,m[u+2]=w.b)}}return c.setAttribute("position",new D(p,3)),c.setAttribute("normal",new D(d,3)),s&&(c.setAttribute("color",new D(m,3)),c.hasColors=!0,c.alpha=b),c}function S(e){let t=new N,o=/solid([\s\S]*?)endsolid/g,a=/facet([\s\S]*?)endfacet/g,f=/solid\s(.+)/,i=0,s=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,m=new RegExp("vertex"+s+s+s,"g"),B=new RegExp("normal"+s+s+s,"g"),C=[],U=[],b=[],g=new z,r,c=0,p=0,d=0;for(;(r=o.exec(e))!==null;){p=d;let w=r[0],n=(r=f.exec(w))!==null?r[1]:"";for(b.push(n);(r=a.exec(w))!==null;){let R=0,v=0,l=r[0];for(;(r=B.exec(l))!==null;)g.x=parseFloat(r[1]),g.y=parseFloat(r[2]),g.z=parseFloat(r[3]),v++;for(;(r=m.exec(l))!==null;)C.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])),U.push(g.x,g.y,g.z),R++,d++;v!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),R!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}let F=p,T=d-p;t.userData.groupNames=b,t.addGroup(F,T,c),c++}return t.setAttribute("position",new H(C,3)),t.setAttribute("normal",new H(U,3)),t}function x(e){return typeof e!="string"?new TextDecoder().decode(e):e}function E(e){if(typeof e=="string"){let t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o)&255;return t.buffer||t}else return e}let A=E(h);return L(A)?y(A):S(x(h))}};export{k as STLLoader};
